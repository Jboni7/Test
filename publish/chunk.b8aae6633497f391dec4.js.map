{"version":3,"sources":["webpack:///./node_modules/@ecomplus/widget-fb-pixel/src/lib/common.js","webpack:///./node_modules/@ecomplus/widget-fb-pixel/src/lib/parse-context.js","webpack:///./node_modules/@ecomplus/widget-fb-pixel/src/index.js","webpack:///./node_modules/@ecomplus/widget-fb-pixel/src/lib/watch-app-routes.js","webpack:///./node_modules/@ecomplus/widget-fb-pixel/src/lib/watch-shopping-cart.js"],"names":["currency","$ecomConfig","get","getProductData","body","data","content_ids","sku","content_name","name","value","price","content_type","categories","length","content_category","category_tree","fbq","options","window","track","evName","isCustomEv","debug","console","log","context","storefront","resource","parseContext","router","storefrontApp","isCartSent","isCheckoutSent","isPurchaseSent","getPurchaseData","amount","total","ecomCart","subtotal","contents","Array","isArray","items","forEach","quantity","push","id","emitCheckout","step","option","purchaseData","customData","checkout_step","checkout_option","emitPurchase","orderId","order_id","addRouteToData","params","currentRoute","afterEach","watchAppRoutes","on","item"],"mappings":"sHAEO,MAAMA,EAAWC,cAAYC,IAAI,aAAe,MAE1CC,EAAiBC,IAC5B,MAAMC,EAAO,CACXL,WACAM,YAAa,CAACF,EAAKG,KACnBC,aAAcJ,EAAKK,KACnBC,MAAOC,YAAMP,GACbQ,aAAc,WAKhB,OAHIR,EAAKS,YAAcT,EAAKS,WAAWC,SACrCT,EAAKU,iBAAmBX,EAAKY,eAAiBZ,EAAKS,WAAW,GAAGJ,MAE5DJ,GCbMY,I,OCEA,WAACC,EAAU,MACxB,GAA0B,mBAAfC,OAAOF,IAAoB,CACpC,MAAMG,EAAQ,CAACC,EAAQhB,EAAO,GAAIiB,GAAa,KACzCJ,EAAQK,OACVC,QAAQC,IAAI,MAAOJ,EAAQhB,GAE7Bc,OAAOF,IAAIK,EAAa,cAAgB,QAASD,EAAQhB,IDRhDY,KACb,MAAMS,EAAUP,OAAOQ,YAAcR,OAAOQ,WAAWD,QACnDA,GAAgC,aAArBA,EAAQE,UACrBX,EAAI,cAAed,EAAeuB,EAAQtB,QCQ1CyB,CAAaT,GCVFH,KACb,MAAMa,EAASX,OAAOY,eAAiBZ,OAAOY,cAAcD,OAC5D,GAAIA,EAAQ,CACV,IAAIE,EAAYC,EAAgBC,EAEhC,MAAMC,EAAkB,KACtB,MAAM,OAAEC,GAAWjB,OAAOY,cACpB1B,EAAO,CACXK,MACG0B,GAAUA,EAAOC,OACjBC,IAASjC,MAAQiC,IAASjC,KAAKkC,UAChC,EAEFvC,WACAwC,SAAU,GACV5B,aAAc,WAOhB,OALI0B,IAASjC,MAAQoC,MAAMC,QAAQJ,IAASjC,KAAKsC,QAC/CL,IAASjC,KAAKsC,MAAMC,SAAQ,EAAGrC,MAAKsC,eAClCxC,EAAKmC,SAASM,KAAK,CAAEC,GAAIxC,EAAKsC,gBAG3BxC,GAGH2C,EAAe,CAACC,EAAMC,KAC1B,MAAMC,EAAehB,IACfiB,EAAa,IACdD,EACHE,cAAeJ,EACfK,gBAAiBJ,GAEfD,GAAQ,IAAMjB,GAChBf,EAAI,mBAAoBkC,GACxBlC,EAAI,WAAYmC,GAAY,GAC5BpB,GAAa,GACHC,IACVhB,EAAI,iBAAkBmC,GAAY,GAClCnB,GAAiB,IAIfsB,EAAeC,IACdtB,IACHjB,EAAI,WAAY,IACXkB,IACHsB,SAAUD,IAEZtB,GAAiB,IAIfwB,EAAiB,EAAGjD,OAAMkD,aAC9B,OAAQlD,GACN,IAAK,OACHuC,EAAa,EAAG,eAChB,MACF,IAAK,WACHA,EAAa,EAAG,oBAChB,MACF,IAAK,eACHO,EAAaI,EAAOZ,MAKtBjB,EAAO8B,cACTF,EAAe5B,EAAO8B,cAExB9B,EAAO+B,UAAUH,KD1DjBI,CAAe1C,GEXJH,EFYOG,EEXpBkB,IAASyB,GAAG,WAAW,EAAGC,WACxB/C,EAAI,YAAad,EAAe6D,OAFrB/C","file":"chunk.b8aae6633497f391dec4.js","sourcesContent":["import { $ecomConfig, price } from '@ecomplus/utils'\n\nexport const currency = $ecomConfig.get('currency') || 'BRL'\n\nexport const getProductData = body => {\n  const data = {\n    currency,\n    content_ids: [body.sku],\n    content_name: body.name,\n    value: price(body),\n    content_type: 'product'\n  }\n  if (body.categories && body.categories.length) {\n    data.content_category = body.category_tree || body.categories[0].name\n  }\n  return data\n}\n","import { getProductData } from './common'\n\nexport default fbq => {\n  const context = window.storefront && window.storefront.context\n  if (context && context.resource === 'products') {\n    fbq('ViewContent', getProductData(context.body))\n  }\n}\n","import parseContext from './lib/parse-context'\nimport watchAppRoutes from './lib/watch-app-routes'\nimport watchShoppingCart from './lib/watch-shopping-cart'\n\nexport default (options = {}) => {\n  if (typeof window.fbq === 'function') {\n    const track = (evName, data = {}, isCustomEv = false) => {\n      if (options.debug) {\n        console.log('fbq', evName, data)\n      }\n      window.fbq(isCustomEv ? 'trackCustom' : 'track', evName, data)\n    }\n\n    parseContext(track)\n    watchAppRoutes(track)\n    watchShoppingCart(track)\n  }\n}\n","import ecomCart from '@ecomplus/shopping-cart'\nimport { currency } from './common'\n\nexport default fbq => {\n  const router = window.storefrontApp && window.storefrontApp.router\n  if (router) {\n    let isCartSent, isCheckoutSent, isPurchaseSent\n\n    const getPurchaseData = () => {\n      const { amount } = window.storefrontApp\n      const data = {\n        value: (\n          (amount && amount.total) ||\n          (ecomCart.data && ecomCart.data.subtotal) ||\n          0\n        ),\n        currency,\n        contents: [],\n        content_type: 'product'\n      }\n      if (ecomCart.data && Array.isArray(ecomCart.data.items)) {\n        ecomCart.data.items.forEach(({ sku, quantity }) => {\n          data.contents.push({ id: sku, quantity })\n        })\n      }\n      return data\n    }\n\n    const emitCheckout = (step, option) => {\n      const purchaseData = getPurchaseData()\n      const customData = {\n        ...purchaseData,\n        checkout_step: step,\n        checkout_option: option\n      }\n      if (step <= 1 || !isCartSent) {\n        fbq('InitiateCheckout', purchaseData)\n        fbq('Checkout', customData, true)\n        isCartSent = true\n      } else if (!isCheckoutSent) {\n        fbq('CheckoutOption', customData, true)\n        isCheckoutSent = true\n      }\n    }\n\n    const emitPurchase = orderId => {\n      if (!isPurchaseSent) {\n        fbq('Purchase', {\n          ...getPurchaseData(),\n          order_id: orderId\n        })\n        isPurchaseSent = true\n      }\n    }\n\n    const addRouteToData = ({ name, params }) => {\n      switch (name) {\n        case 'cart':\n          emitCheckout(1, 'Review Cart')\n          break\n        case 'checkout':\n          emitCheckout(2, 'Confirm Purchase')\n          break\n        case 'confirmation':\n          emitPurchase(params.id)\n          break\n      }\n    }\n\n    if (router.currentRoute) {\n      addRouteToData(router.currentRoute)\n    }\n    router.afterEach(addRouteToData)\n  }\n}\n","import ecomCart from '@ecomplus/shopping-cart'\nimport { getProductData } from './common'\n\nexport default fbq => {\n  ecomCart.on('addItem', ({ item }) => {\n    fbq('AddToCart', getProductData(item))\n  })\n}\n"],"sourceRoot":""}