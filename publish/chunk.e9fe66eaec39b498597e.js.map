{"version":3,"sources":["webpack:///./node_modules/@ecomplus/widget-ebit/src/index.js"],"names":["options","ebitStoreId","router","window","storefrontApp","countConfirmation","addConfirmationBanner","name","params","ecomPassport","fetchOrder","id","then","order","customer","getCustomer","ebitParam","amount","total","freight","number","_id","main_email","gender","toUpperCase","birth_date","day","month","year","toString","padStart","items","length","skus","sku","values","getPrice","quantities","quantity","names","encodeURIComponent","i","shipping_lines","shippingLine","delivery_time","days","to","zip","transactions","transaction","installments","payment_method","code","credit_card","company","toLowerCase","tryAppendInterval","setInterval","$confirmation","document","getElementById","insertAdjacentHTML","$script","createElement","type","src","body","appendChild","clearInterval","catch","console","error","currentRoute","afterEach","Error"],"mappings":"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","file":"chunk.e9fe66eaec39b498597e.js","sourcesContent":["import { price as getPrice } from '@ecomplus/utils'\nimport ecomPassport from '@ecomplus/passport-client'\n\nexport default (options = {}) => {\n  const { ebitStoreId } = options\n  if (ebitStoreId) {\n    const router = window.storefrontApp && window.storefrontApp.router\n    if (router) {\n      let countConfirmation = 0\n      const addConfirmationBanner = ({ name, params }) => {\n        if (name === 'confirmation' && countConfirmation === 0) {\n          countConfirmation++\n          ecomPassport.fetchOrder(params.id)\n            .then(order => {\n              const customer = ecomPassport.getCustomer()\n              let ebitParam = `storeId=${ebitStoreId}&mktSaleId=0&platform=ecomplus` +\n                `&totalSpent=${order.amount.total}` +\n                `&deliveryTax=${(order.amount.freight || 0)}` +\n                `&transactionId=${(order.number || order._id)}` +\n                `&email=${customer.main_email}`\n\n              if (customer.gender) {\n                ebitParam += `&gender=${customer.gender.toUpperCase()}`\n              }\n              if (customer.birth_date) {\n                const { day, month, year } = customer.birth_date\n                ebitParam += `&birthday=${day.toString().padStart(2, '0')}` +\n                  `-${month.toString().padStart(2, '0')}-${year}`\n              }\n\n              const { items } = order\n              if (items && items.length) {\n                let skus = items[0].sku\n                let values = getPrice(items[0])\n                let quantities = items[0].quantity\n                let names = encodeURIComponent(items[0].name)\n                for (let i = 1; i < items.length; i++) {\n                  skus += `|${items[i].sku}`\n                  values += `|${getPrice(items[i])}`\n                  quantities += `|${items[i].quantity}`\n                  names += `|${encodeURIComponent(items[i].name)}`\n                }\n                ebitParam += `&sku=${skus}&value=${values}&quantity=${quantities}&productName=${names}`\n              }\n\n              if (order.shipping_lines && order.shipping_lines[0]) {\n                const shippingLine = order.shipping_lines[0]\n                ebitParam += `&deliveryTime=${(shippingLine.delivery_time.days || 0)}` +\n                  `&zipCode=${shippingLine.to.zip}`\n              }\n\n              if (order.transactions && order.transactions[0]) {\n                const transaction = order.transactions[0]\n                ebitParam += `&parcels=${((transaction.installments && transaction.installments.number) || 1)}`\n                ebitParam += '&paymentType='\n                switch (transaction.payment_method.code) {\n                  case 'credit_card':\n                    ebitParam += '05'\n                    break\n                  case 'banking_billet':\n                    ebitParam += '08'\n                    break\n                  case 'debit_card':\n                  case 'online_debit':\n                  case 'account_deposit':\n                    ebitParam += '28'\n                    break\n                  case 'loyalty_points':\n                    ebitParam += '24'\n                    break\n                  default:\n                    ebitParam += '14'\n                }\n\n                if (transaction.credit_card && transaction.credit_card.company) {\n                  ebitParam += '&cardFlag='\n                  switch (transaction.credit_card.company.toLowerCase()) {\n                    case 'visa':\n                      ebitParam += 6\n                      break\n                    case 'mastercard':\n                      ebitParam += 5\n                      break\n                    case 'american express':\n                    case 'amex':\n                      ebitParam += 1\n                      break\n                    case 'elo':\n                      ebitParam += 8\n                      break\n                    case 'aura':\n                      ebitParam += 2\n                      break\n                    case 'hipercard':\n                      ebitParam += 4\n                      break\n                    case 'diners club':\n                      ebitParam += 3\n                      break\n                    default:\n                      ebitParam += 7\n                  }\n                }\n              }\n\n              const appendBanner = () => {\n                const $confirmation = document.getElementById('confirmation')\n                if ($confirmation) {\n                  $confirmation.insertAdjacentHTML(\n                    'beforeend',\n                    `<div> <param id=\"ebitParam\" value=\"${ebitParam}\"> <a id=\"bannerEbit\"></a> </div>`\n                  )\n                  const $script = document.createElement('script')\n                  $script.id = 'getSelo'\n                  $script.type = 'text/javascript'\n                  $script.src = 'https://imgs.ebit.com.br/ebitBR/selo-ebit/js/getSelo.js' +\n                    `?${ebitStoreId}&lightbox=true`\n                  document.body.appendChild($script)\n                  clearInterval(tryAppendInterval)\n                }\n              }\n              const tryAppendInterval = setInterval(appendBanner, 200)\n            })\n            .catch(console.error)\n        }\n      }\n\n      if (router.currentRoute) {\n        addConfirmationBanner(router.currentRoute)\n      }\n      router.afterEach(addConfirmationBanner)\n    }\n  } else {\n    console.error(new Error('Can\\'t show lightbox without `ebitStoreId` option'))\n  }\n}\n"],"sourceRoot":""}