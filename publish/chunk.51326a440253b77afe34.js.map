{"version":3,"sources":["webpack:///./node_modules/core-js/modules/es.promise.all-settled.js","webpack:///./node_modules/core-js/internals/perform.js","webpack:///./node_modules/core-js/internals/iterate.js","webpack:///./node_modules/@ecomplus/widget-gmc-ratings/src/index.js"],"names":["$","aFunction","newPromiseCapabilityModule","perform","iterate","target","stat","allSettled","iterable","C","this","capability","f","resolve","reject","result","promiseResolve","values","counter","remaining","promise","index","alreadyCalled","push","undefined","call","then","value","status","error","reason","module","exports","exec","anObject","isArrayIteratorMethod","toLength","bind","getIteratorMethod","iteratorClose","Result","stopped","unboundFunction","options","iterator","iterFn","length","next","step","that","AS_ENTRIES","IS_ITERATOR","INTERRUPTED","fn","stop","condition","callFn","TypeError","done","gmcMerchantId","dialogPosition","router","window","storefrontApp","addConfirmationDialog","name","params","json","addDays","days","date","Date","now","setDate","getDate","order","customerEmail","deliveryCountry","deliveryDate","orderJson","decodeURIComponent","JSON","parse","e","buyers","main_email","shippingLine","shipping_lines","delivery_time","posting_deadline","working_days","ecomPassport","getCustomer","$ecomConfig","get","promises","gtins","optInConfig","merchant_id","order_id","number","id","email","delivery_country","estimated_delivery_date","getFullYear","getMonth","toString","padStart","opt_in_style","items","i","store","url","product_id","data","gtin","forEach","gtinCode","includes","catch","console","Promise","products","map","gapi","load","surveyoptin","render","currentRoute","afterEach","Error"],"mappings":"2FACA,IAAIA,EAAI,EAAQ,IACZC,EAAY,EAAQ,IACpBC,EAA6B,EAAQ,KACrCC,EAAU,EAAQ,KAClBC,EAAU,EAAQ,KAItBJ,EAAE,CAAEK,OAAQ,UAAWC,MAAM,GAAQ,CACnCC,WAAY,SAAoBC,GAC9B,IAAIC,EAAIC,KACJC,EAAaT,EAA2BU,EAAEH,GAC1CI,EAAUF,EAAWE,QACrBC,EAASH,EAAWG,OACpBC,EAASZ,GAAQ,WACnB,IAAIa,EAAiBf,EAAUQ,EAAEI,SAC7BI,EAAS,GACTC,EAAU,EACVC,EAAY,EAChBf,EAAQI,GAAU,SAAUY,GAC1B,IAAIC,EAAQH,IACRI,GAAgB,EACpBL,EAAOM,UAAKC,GACZL,IACAH,EAAeS,KAAKhB,EAAGW,GAASM,MAAK,SAAUC,GACzCL,IACJA,GAAgB,EAChBL,EAAOI,GAAS,CAAEO,OAAQ,YAAaD,MAAOA,KAC5CR,GAAaN,EAAQI,OACtB,SAAUY,GACPP,IACJA,GAAgB,EAChBL,EAAOI,GAAS,CAAEO,OAAQ,WAAYE,OAAQD,KAC5CV,GAAaN,EAAQI,YAGzBE,GAAaN,EAAQI,MAGzB,OADIF,EAAOc,OAAOf,EAAOC,EAAOY,OACzBhB,EAAWS,Y,kBCxCtBW,EAAOC,QAAU,SAAUC,GACzB,IACE,MAAO,CAAEJ,OAAO,EAAOF,MAAOM,KAC9B,MAAOJ,GACP,MAAO,CAAEA,OAAO,EAAMF,MAAOE,M,oBCJjC,IAAIK,EAAW,EAAQ,IACnBC,EAAwB,EAAQ,KAChCC,EAAW,EAAQ,IACnBC,EAAO,EAAQ,KACfC,EAAoB,EAAQ,KAC5BC,EAAgB,EAAQ,KAExBC,EAAS,SAAUC,EAAS1B,GAC9BL,KAAK+B,QAAUA,EACf/B,KAAKK,OAASA,GAGhBgB,EAAOC,QAAU,SAAUxB,EAAUkC,EAAiBC,GACpD,IAKIC,EAAUC,EAAQxB,EAAOyB,EAAQ/B,EAAQgC,EAAMC,EAL/CC,EAAON,GAAWA,EAAQM,KAC1BC,KAAgBP,IAAWA,EAAQO,YACnCC,KAAiBR,IAAWA,EAAQQ,aACpCC,KAAiBT,IAAWA,EAAQS,aACpCC,EAAKhB,EAAKK,EAAiBO,EAAM,EAAIC,EAAaE,GAGlDE,EAAO,SAAUC,GAEnB,OADIX,GAAUL,EAAcK,GACrB,IAAIJ,GAAO,EAAMe,IAGtBC,EAAS,SAAU7B,GACrB,OAAIuB,GACFhB,EAASP,GACFyB,EAAcC,EAAG1B,EAAM,GAAIA,EAAM,GAAI2B,GAAQD,EAAG1B,EAAM,GAAIA,EAAM,KAChEyB,EAAcC,EAAG1B,EAAO2B,GAAQD,EAAG1B,IAG9C,GAAIwB,EACFP,EAAWpC,MACN,CAEL,GAAqB,mBADrBqC,EAASP,EAAkB9B,IACM,MAAMiD,UAAU,0BAEjD,GAAItB,EAAsBU,GAAS,CACjC,IAAKxB,EAAQ,EAAGyB,EAASV,EAAS5B,EAASsC,QAASA,EAASzB,EAAOA,IAElE,IADAN,EAASyC,EAAOhD,EAASa,MACXN,aAAkByB,EAAQ,OAAOzB,EAC/C,OAAO,IAAIyB,GAAO,GAEtBI,EAAWC,EAAOpB,KAAKjB,GAIzB,IADAuC,EAAOH,EAASG,OACPC,EAAOD,EAAKtB,KAAKmB,IAAWc,MAAM,CACzC,IACE3C,EAASyC,EAAOR,EAAKrB,OACrB,MAAOE,GAEP,MADAU,EAAcK,GACRf,EAER,GAAqB,iBAAVd,GAAsBA,GAAUA,aAAkByB,EAAQ,OAAOzB,EAC5E,OAAO,IAAIyB,GAAO,K,+ECpDP,WAACG,EAAU,MACxB,MAAM,cAAEgB,EAAF,eAAiBC,GAAmBjB,EAC1C,GAAIgB,EAAe,CACjB,MAAME,EAASC,OAAOC,eAAiBD,OAAOC,cAAcF,OAC5D,GAAIA,EAAQ,CACV,MAAMG,EAAwB,EAAGC,OAAMC,aACrC,GAAa,iBAATD,GAA2BC,EAAOC,KAAM,CAC1C,MAAMC,EAAUC,IACd,MAAMC,EAAO,IAAIC,KAAKA,KAAKC,OAE3B,OADAF,EAAKG,QAAQH,EAAKI,UAAYL,GACvBC,GAGT,IAAIK,EAAOC,EAAeC,EAAiBC,EAC3C,MAAMC,EAAYC,mBAAmBd,EAAOC,MAC5C,GAAIY,EACF,IACEJ,EAAQM,KAAKC,MAAMH,GACnB,MAAOI,IAIX,GAAIR,EAAO,CACT,MAAM,OAAES,GAAWT,EACfS,GAAUA,EAAO,KACnBR,EAAgBQ,EAAO,GAAGC,YAE5B,MAAMC,EAAeX,EAAMY,gBAAkBZ,EAAMY,eAAe,GAClE,GAAID,GAAgBA,EAAaE,cAAe,CAC9C,IAAInB,EAAOiB,EAAaE,cAAcnB,KAClCiB,EAAaG,mBACfpB,GAAQiB,EAAaE,cAAcnB,MAEjCiB,EAAaE,cAAcE,eAC7BrB,GAAQ,MAEVS,EAAeV,EAAQC,EAAO,IAI7BO,IACHA,EAAgBe,IAAaC,cAAcP,YAExCR,IACHA,EAAkBgB,cAAYC,IAAI,iBAE/BhB,IACHA,EAAeV,EAAQ,KAGzB,MAAM2B,EAAW,GACXC,EAAQ,GACRC,EAAc,CAClBC,YAAavC,EACbwC,SAAUjC,EAAOkC,QAAUlC,EAAOmC,GAClCC,MAAO1B,EACP2B,iBAAkB1B,EAClB2B,wBAAyB1B,EAAa2B,cAAb,YAClB3B,EAAa4B,WAAa,GAAGC,WAAWC,SAAS,EAAG,KADlC,KAEvB9B,EAAaJ,UAAUiC,WAAWC,SAAS,EAAG,KAChDC,aAAcjD,GAAkB,iBAGlC,GAAIe,GAASA,EAAMmC,MACjB,IAAK,IAAIC,EAAI,EAAGA,EAAIpC,EAAMmC,MAAMhE,QAAUiE,GAAK,EAAGA,IAChDhB,EAASxE,KACPyF,YAAM,CAAEC,IAAK,aAAF,OAAetC,EAAMmC,MAAMC,GAAGG,WAA9B,WACRxF,MAAK,EAAGyF,WACHA,EAAKC,MACPD,EAAKC,KAAKC,SAAQC,IACXtB,EAAMuB,SAASD,IAClBtB,EAAMzE,KAAK+F,SAKlBE,MAAMC,QAAQ5F,QAKvB6F,QAAQnH,WAAWwF,GAAUrE,MAAK,KAC5BsE,EAAMlD,SACRmD,EAAY0B,SAAW3B,EAAM4B,KAAIR,IAAQ,CAAGA,YAE9CtD,OAAO+D,KAAKC,KAAK,eAAe,WAC9BhE,OAAO+D,KAAKE,YAAYC,OAAO/B,WAMnCpC,EAAOoE,cACTjE,EAAsBH,EAAOoE,cAE/BpE,EAAOqE,UAAUlE,SAGnByD,QAAQ5F,MAAM,IAAIsG,MAAM","file":"chunk.51326a440253b77afe34.js","sourcesContent":["'use strict';\nvar $ = require('../internals/export');\nvar aFunction = require('../internals/a-function');\nvar newPromiseCapabilityModule = require('../internals/new-promise-capability');\nvar perform = require('../internals/perform');\nvar iterate = require('../internals/iterate');\n\n// `Promise.allSettled` method\n// https://github.com/tc39/proposal-promise-allSettled\n$({ target: 'Promise', stat: true }, {\n  allSettled: function allSettled(iterable) {\n    var C = this;\n    var capability = newPromiseCapabilityModule.f(C);\n    var resolve = capability.resolve;\n    var reject = capability.reject;\n    var result = perform(function () {\n      var promiseResolve = aFunction(C.resolve);\n      var values = [];\n      var counter = 0;\n      var remaining = 1;\n      iterate(iterable, function (promise) {\n        var index = counter++;\n        var alreadyCalled = false;\n        values.push(undefined);\n        remaining++;\n        promiseResolve.call(C, promise).then(function (value) {\n          if (alreadyCalled) return;\n          alreadyCalled = true;\n          values[index] = { status: 'fulfilled', value: value };\n          --remaining || resolve(values);\n        }, function (error) {\n          if (alreadyCalled) return;\n          alreadyCalled = true;\n          values[index] = { status: 'rejected', reason: error };\n          --remaining || resolve(values);\n        });\n      });\n      --remaining || resolve(values);\n    });\n    if (result.error) reject(result.value);\n    return capability.promise;\n  }\n});\n","module.exports = function (exec) {\n  try {\n    return { error: false, value: exec() };\n  } catch (error) {\n    return { error: true, value: error };\n  }\n};\n","var anObject = require('../internals/an-object');\nvar isArrayIteratorMethod = require('../internals/is-array-iterator-method');\nvar toLength = require('../internals/to-length');\nvar bind = require('../internals/function-bind-context');\nvar getIteratorMethod = require('../internals/get-iterator-method');\nvar iteratorClose = require('../internals/iterator-close');\n\nvar Result = function (stopped, result) {\n  this.stopped = stopped;\n  this.result = result;\n};\n\nmodule.exports = function (iterable, unboundFunction, options) {\n  var that = options && options.that;\n  var AS_ENTRIES = !!(options && options.AS_ENTRIES);\n  var IS_ITERATOR = !!(options && options.IS_ITERATOR);\n  var INTERRUPTED = !!(options && options.INTERRUPTED);\n  var fn = bind(unboundFunction, that, 1 + AS_ENTRIES + INTERRUPTED);\n  var iterator, iterFn, index, length, result, next, step;\n\n  var stop = function (condition) {\n    if (iterator) iteratorClose(iterator);\n    return new Result(true, condition);\n  };\n\n  var callFn = function (value) {\n    if (AS_ENTRIES) {\n      anObject(value);\n      return INTERRUPTED ? fn(value[0], value[1], stop) : fn(value[0], value[1]);\n    } return INTERRUPTED ? fn(value, stop) : fn(value);\n  };\n\n  if (IS_ITERATOR) {\n    iterator = iterable;\n  } else {\n    iterFn = getIteratorMethod(iterable);\n    if (typeof iterFn != 'function') throw TypeError('Target is not iterable');\n    // optimisation for array iterators\n    if (isArrayIteratorMethod(iterFn)) {\n      for (index = 0, length = toLength(iterable.length); length > index; index++) {\n        result = callFn(iterable[index]);\n        if (result && result instanceof Result) return result;\n      } return new Result(false);\n    }\n    iterator = iterFn.call(iterable);\n  }\n\n  next = iterator.next;\n  while (!(step = next.call(iterator)).done) {\n    try {\n      result = callFn(step.value);\n    } catch (error) {\n      iteratorClose(iterator);\n      throw error;\n    }\n    if (typeof result == 'object' && result && result instanceof Result) return result;\n  } return new Result(false);\n};\n","import { $ecomConfig } from '@ecomplus/utils'\nimport { store } from '@ecomplus/client'\nimport ecomPassport from '@ecomplus/passport-client'\n\nexport default (options = {}) => {\n  const { gmcMerchantId, dialogPosition } = options\n  if (gmcMerchantId) {\n    const router = window.storefrontApp && window.storefrontApp.router\n    if (router) {\n      const addConfirmationDialog = ({ name, params }) => {\n        if (name === 'confirmation' && params.json) {\n          const addDays = days => {\n            const date = new Date(Date.now())\n            date.setDate(date.getDate() + days)\n            return date\n          }\n\n          let order, customerEmail, deliveryCountry, deliveryDate\n          const orderJson = decodeURIComponent(params.json)\n          if (orderJson) {\n            try {\n              order = JSON.parse(orderJson)\n            } catch (e) {\n            }\n          }\n\n          if (order) {\n            const { buyers } = order\n            if (buyers && buyers[0]) {\n              customerEmail = buyers[0].main_email\n            }\n            const shippingLine = order.shipping_lines && order.shipping_lines[0]\n            if (shippingLine && shippingLine.delivery_time) {\n              let days = shippingLine.delivery_time.days\n              if (shippingLine.posting_deadline) {\n                days += shippingLine.delivery_time.days\n              }\n              if (shippingLine.delivery_time.working_days) {\n                days *= 1.25\n              }\n              deliveryDate = addDays(days + 3)\n            }\n          }\n\n          if (!customerEmail) {\n            customerEmail = ecomPassport.getCustomer().main_email\n          }\n          if (!deliveryCountry) {\n            deliveryCountry = $ecomConfig.get('country_code')\n          }\n          if (!deliveryDate) {\n            deliveryDate = addDays(14)\n          }\n\n          const promises = []\n          const gtins = []\n          const optInConfig = {\n            merchant_id: gmcMerchantId,\n            order_id: params.number || params.id,\n            email: customerEmail,\n            delivery_country: deliveryCountry,\n            estimated_delivery_date: deliveryDate.getFullYear() +\n              `-${(deliveryDate.getMonth() + 1).toString().padStart(2, '0')}-` +\n              deliveryDate.getDate().toString().padStart(2, '0'),\n            opt_in_style: dialogPosition || 'CENTER_DIALOG'\n          }\n\n          if (order && order.items) {\n            for (let i = 0; i < order.items.length && i <= 4; i++) {\n              promises.push(\n                store({ url: `/products/${order.items[i].product_id}.json` })\n                  .then(({ data }) => {\n                    if (data.gtin) {\n                      data.gtin.forEach(gtinCode => {\n                        if (!gtins.includes(gtinCode)) {\n                          gtins.push(gtinCode)\n                        }\n                      })\n                    }\n                  })\n                  .catch(console.error)\n              )\n            }\n          }\n\n          Promise.allSettled(promises).then(() => {\n            if (gtins.length) {\n              optInConfig.products = gtins.map(gtin => ({ gtin }))\n            }\n            window.gapi.load('surveyoptin', function () {\n              window.gapi.surveyoptin.render(optInConfig)\n            })\n          })\n        }\n      }\n\n      if (router.currentRoute) {\n        addConfirmationDialog(router.currentRoute)\n      }\n      router.afterEach(addConfirmationDialog)\n    }\n  } else {\n    console.error(new Error('Can\\'t show opt-in dialog without `gmcMerchantId` option'))\n  }\n}\n"],"sourceRoot":""}